# .NET Core Implementation Plan for Fix My English Application

## Overview
This document outlines the plan for recreating the Python-based "Fix My English" application in .NET Core. The original application is a system tray utility that helps users correct their English text using Google's Generative AI and provides periodic English tips.

## Core Features to Implement

1. **System Tray Integration**
   - Create a system tray icon with context menu
   - Implement menu options for service control, tips management, and application exit

2. **Input Window**
   - Create a floating, borderless window with rounded corners
   - Implement draggable functionality
   - Add multi-line text input with scrollbar
   - Handle keyboard shortcuts (Ctrl+Enter to submit, Esc to cancel)

3. **Text Correction Functionality**
   - Integrate with Google Generative AI API
   - Process user input and return corrected text
   - Implement clipboard operations to paste corrected text

4. **Tips System**
   - Implement periodic English tips functionality
   - Create configurable intervals (1, 3, 5, 10 minutes)
   - Display tips in a floating window with auto-close timer
   - Allow viewing of the latest tip on demand

5. **Global Hotkey Support**
   - Register Ctrl+Alt+Space for toggling the input window
   - Implement service start/stop functionality

## Technology Stack

### Core Technologies
- **.NET Core 8.0** - Latest stable version for modern features and cross-platform support
- **Windows Presentation Foundation (WPF)** - For UI components
- **System.Drawing.Common** - For icon creation and image manipulation
- **Hardcodet.NotifyIcon.Wpf** - NuGet package for system tray integration
- **Google.Generative.AI** - Official .NET client for Google's Generative AI

### Additional Libraries
- **NHotkey** - For global hotkey registration
- **MaterialDesignInXAML** - For modern UI components (optional)
- **Newtonsoft.Json** - For JSON handling

## Architecture

### Main Components

1. **App Class**
   - Application entry point
   - Manages application lifecycle

2. **MainViewModel**
   - Implements the application's core logic
   - Manages state and coordinates between components
   - Handles service running status

3. **InputWindow**
   - Custom WPF window for text input
   - Implements draggable, borderless window with rounded corners
   - Handles keyboard shortcuts

4. **TrayIconManager**
   - Manages the system tray icon and its context menu
   - Handles menu item clicks and updates menu state

5. **TipsManager**
   - Manages the tips functionality
   - Schedules tips based on configured interval
   - Stores and retrieves the latest tip

6. **AIService**
   - Handles communication with Google Generative AI
   - Processes text correction requests
   - Generates English tips

7. **TipWindow**
   - Displays English tips in a floating window
   - Implements auto-close timer and mouse tracking

8. **HotkeyManager**
   - Registers and handles global hotkeys
   - Toggles based on service status

## Implementation Details

### System Tray Icon
```csharp
// Using Hardcodet.NotifyIcon.Wpf
private TaskbarIcon _notifyIcon;

private void InitializeNotifyIcon()
{
    _notifyIcon = new TaskbarIcon
    {
        Icon = CreateTrayIcon(),
        ToolTipText = "Fix My English"
    };
    
    _notifyIcon.ContextMenu = CreateContextMenu();
}
```

### Custom Window with Rounded Corners
```csharp
// In XAML
<Window x:Class="FixMyEnglish.InputWindow"
        AllowsTransparency="True"
        WindowStyle="None"
        Background="Transparent"
        ResizeMode="NoResize"
        Topmost="True">
    <Border CornerRadius="15" Background="#3498db">
        <Border CornerRadius="15" Margin="2" Background="White">
            <!-- Content -->
        </Border>
    </Border>
</Window>

// In code-behind for dragging
private void Border_MouseDown(object sender, MouseButtonEventArgs e)
{
    if (e.ChangedButton == MouseButton.Left)
        this.DragMove();
}
```

### Global Hotkey Registration
```csharp
private void RegisterHotkey()
{
    if (_serviceRunning)
    {
        HotkeyManager.Current.AddOrReplace("ToggleInput", Key.Space, ModifierKeys.Control | ModifierKeys.Alt, OnHotkeyPressed);
    }
    else
    {
        HotkeyManager.Current.Remove("ToggleInput");
    }
}

private void OnHotkeyPressed(object sender, HotkeyEventArgs e)
{
    ToggleInputField();
    e.Handled = true;
}
```

### Google Generative AI Integration
```csharp
private async Task<string> CorrectTextAsync(string inputText)
{
    try
    {
        var model = new GenerativeModel("gemini-2.0-flash-lite");
        
        string prompt = $@"TASK: Fix the English text below.
INSTRUCTIONS: 
- Improve grammar and spelling
- Make it sound natural for casual business communication
- Maintain the original meaning
- Only return the corrected text with no explanations

TEXT TO FIX:
{inputText}

Remember to ONLY return the corrected version of the text above, nothing else.";

        var response = await model.GenerateContentAsync(prompt);
        return response.Text.Trim();
    }
    catch (Exception ex)
    {
        // Handle error
        return null;
    }
}
```

### Tips Timer Implementation
```csharp
private DispatcherTimer _tipsTimer;

private void SetupTipsTimer()
{
    _tipsTimer = new DispatcherTimer
    {
        Interval = TimeSpan.FromMilliseconds(_tipsInterval)
    };
    _tipsTimer.Tick += (s, e) => ShowTip();
    
    if (_tipsEnabled)
        _tipsTimer.Start();
}

private void UpdateTipsInterval(int intervalKey)
{
    _currentIntervalKey = intervalKey;
    _tipsInterval = _tipsIntervals[intervalKey];
    
    if (_tipsEnabled && _tipsTimer != null)
    {
        _tipsTimer.Stop();
        _tipsTimer.Interval = TimeSpan.FromMilliseconds(_tipsInterval);
        _tipsTimer.Start();
    }
}
```

## UI Design
The application will maintain the modern, clean UI of the original with:
- Blue color scheme (#3498db primary color)
- Rounded corners on all windows
- Custom scrollbars
- Fade-in/fade-out animations
- Clear typography using Segoe UI font

## File Structure
```
FixMyEnglish/
├── App.xaml / App.xaml.cs
├── MainViewModel.cs
├── Windows/
│   ├── InputWindow.xaml / InputWindow.xaml.cs
│   └── TipWindow.xaml / TipWindow.xaml.cs
├── Services/
│   ├── AIService.cs
│   ├── TipsManager.cs
│   ├── HotkeyManager.cs
│   └── TrayIconManager.cs
├── Helpers/
│   ├── IconHelper.cs
│   └── AnimationHelper.cs
└── Resources/
    └── Styles.xaml
```

## Implementation Phases

### Phase 1: Core Application Setup
- Create project structure
- Implement system tray icon and basic menu
- Set up application lifecycle management

### Phase 2: Input Window Implementation
- Create custom window with rounded corners
- Implement dragging functionality
- Add text input field with scrollbar

### Phase 3: AI Integration
- Set up Google Generative AI client
- Implement text correction functionality
- Add clipboard operations

### Phase 4: Tips System
- Implement tips timer and scheduling
- Create tip window with auto-close functionality
- Add tip generation and display

### Phase 5: Global Hotkey and Service Management
- Implement global hotkey registration
- Add service start/stop functionality
- Ensure proper cleanup on application exit

### Phase 6: Testing and Refinement
- Test all features for functionality
- Refine UI and animations
- Optimize performance

## Additional Considerations

### Error Handling
- Implement comprehensive error handling for API calls
- Add user-friendly error messages
- Log errors for debugging

### Configuration
- Store user preferences (tips interval, enabled state)
- Save and restore window positions
- Securely store API key

### Accessibility
- Ensure keyboard navigation works properly
- Add appropriate focus management
- Consider high contrast support

## Conclusion
This implementation plan provides a comprehensive roadmap for recreating the "Fix My English" application in .NET Core. The application will maintain all the functionality of the original Python version while leveraging the strengths of the .NET ecosystem for improved performance and maintainability.
